<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ZendoWhisper</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: linear-gradient(135deg, #0a1a2e 0%, #1e3a5f 50%, #2d5a87 100%);
        color: #f9fafb;
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
        transition: background 0.5s ease;
      }
      /* When remote website loads, it will have its own background */
      body.loaded {
        background: transparent;
      }
      .card {
        background: rgba(26, 54, 93, 0.95);
        padding: 3rem 3.5rem;
        border-radius: 2rem;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6), 
                    0 0 0 1px rgba(69, 147, 255, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
        text-align: center;
        max-width: 480px;
        width: 100%;
        border: 1px solid rgba(69, 147, 255, 0.25);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        position: relative;
        overflow: hidden;
      }
      .card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(69, 147, 255, 0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
        pointer-events: none;
      }
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      /* Hide loading card when remote site loads */
      body.loaded .card {
        display: none;
      }
      .logo {
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin-bottom: 0.5rem;
      }
      .accent {
        background: linear-gradient(135deg, #4593ff 0%, #6bb6ff 50%, #8fc9ff 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      .subtitle {
        font-size: 0.95rem;
        color: #b3d9ff;
        margin-bottom: 2rem;
      }
      .spinner {
        width: 44px;
        height: 44px;
        border-radius: 999px;
        border: 3px solid rgba(69, 147, 255, 0.3);
        border-top-color: #4593ff;
        margin: 0 auto 1rem auto;
        animation: spin 0.9s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .state-text {
        font-size: 1rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
      }
      .hint {
        font-size: 0.85rem;
        color: #a8cfff;
      }
      .offline {
        display: none;
      }
      .offline-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      .error-state {
        display: none;
      }
      .error-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        color: #ff6b6b;
      }
      .error-code {
        font-size: 0.85rem;
        color: #a8cfff;
        margin-top: 0.5rem;
        font-family: monospace;
      }
      .splash-state {
        display: block;
      }
      .splash-logo-container {
        margin-bottom: 2rem;
        animation: fadeInScale 1s ease-out;
      }
      .splash-logo-img {
        width: 120px;
        height: 120px;
        margin: 0 auto 1.5rem;
        display: block;
        filter: drop-shadow(0 10px 30px rgba(69, 147, 255, 0.4));
        animation: float 3s ease-in-out infinite;
      }
      .splash-logo-text {
        font-size: 1.8rem;
        font-weight: 700;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        background: linear-gradient(135deg, #4593ff 0%, #6bb6ff 50%, #8fc9ff 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 0.5rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
      .splash-tagline {
        font-size: 0.9rem;
        color: #b3d9ff;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 300;
        opacity: 0.8;
      }
      .splash-spinner-container {
        margin-top: 2.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
      .splash-spinner {
        width: 50px;
        height: 50px;
        border-radius: 999px;
        border: 3px solid rgba(69, 147, 255, 0.2);
        border-top-color: #4593ff;
        animation: spin 1s linear infinite;
      }
      .splash-status {
        font-size: 0.9rem;
        color: #a8cfff;
        font-weight: 400;
        letter-spacing: 0.05em;
      }
      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .button {
        margin-top: 1.5rem;
        padding: 0.7rem 1.4rem;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 500;
        background: linear-gradient(135deg, #4593ff 0%, #6bb6ff 100%);
        color: #ffffff;
        box-shadow: 0 4px 15px rgba(69, 147, 255, 0.3);
        transition: all 0.3s ease;
      }
      .button:hover {
        background: linear-gradient(135deg, #5ba0ff 0%, #7bc4ff 100%);
        box-shadow: 0 6px 20px rgba(69, 147, 255, 0.4);
        transform: translateY(-2px);
      }
      .button:active {
        transform: translateY(1px);
      }
    </style>
  </head>
  <body>
    <div class="card">
      <!-- Splash Screen -->
      <div id="splash-state" class="splash-state">
        <div class="splash-logo-container">
          <img src="../assets/logo.png" alt="ZendoWhisper Logo" class="splash-logo-img" />
          <div class="splash-logo-text">ZendoWhisper</div>
          <div class="splash-tagline">Your Workspace, Reimagined</div>
        </div>
        <div class="splash-spinner-container">
          <div class="splash-spinner"></div>
          <div class="splash-status" id="splash-status">Initializing...</div>
        </div>
      </div>

      <!-- Loading state -->
      <div id="loading-state" style="display: none;">
        <div class="logo">
          <span class="accent">ZendoWhisper</span>
        </div>
        <div class="subtitle" id="subtitle">
          Loading your ZendoWhisper workspace‚Ä¶
        </div>
        <div class="spinner"></div>
        <div class="state-text" id="state-text">Connecting to app.zendowhisper.com‚Ä¶</div>
        <div class="hint">
          Please wait while we load the application.
        </div>
      </div>

      <!-- Offline state -->
      <div id="offline-state" class="offline">
        <div class="logo">
          <span class="accent">ZendoWhisper</span>
        </div>
        <div class="offline-icon">üì°</div>
        <div class="state-text">No internet connection</div>
        <div class="hint">
          ZendoWhisper needs an internet connection. Check your network and try
          again.
        </div>
        <button id="retry" class="button">Retry</button>
      </div>

      <!-- Error state -->
      <div id="error-state" class="error-state">
        <div class="logo">
          <span class="accent">ZendoWhisper</span>
        </div>
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="state-text">Failed to load application</div>
        <div class="hint" id="error-message">
          An error occurred while loading the application.
        </div>
        <div class="error-code" id="error-code"></div>
        <button id="retry-error" class="button">Retry</button>
      </div>
    </div>

    <script>
      const APP_URL = "https://app.zendowhisper.com/";
      const splashState = document.getElementById("splash-state");
      const loadingState = document.getElementById("loading-state");
      const offlineState = document.getElementById("offline-state");
      const errorState = document.getElementById("error-state");
      const subtitle = document.getElementById("subtitle");
      const stateText = document.getElementById("state-text");
      const splashStatus = document.getElementById("splash-status");
      const errorMessage = document.getElementById("error-message");
      const errorCode = document.getElementById("error-code");
      const retryBtn = document.getElementById("retry");
      const retryErrorBtn = document.getElementById("retry-error");

      let isLoading = false;

      function hideAllStates() {
        splashState.style.display = "none";
        loadingState.style.display = "none";
        offlineState.style.display = "none";
        errorState.style.display = "none";
      }

      function showSplash(statusMessage = "Initializing...") {
        hideAllStates();
        splashState.style.display = "block";
        if (splashStatus) splashStatus.textContent = statusMessage;
      }

      function showLoading(message = "Connecting to app.zendowhisper.com‚Ä¶") {
        hideAllStates();
        loadingState.style.display = "block";
        if (subtitle) subtitle.textContent = "Loading your ZendoWhisper workspace‚Ä¶";
        if (stateText) stateText.textContent = message;
        isLoading = true;
      }

      function showOffline() {
        hideAllStates();
        offlineState.style.display = "block";
        isLoading = false;
      }

      function showError(code, description) {
        hideAllStates();
        errorState.style.display = "block";
        isLoading = false;
        
        let userMessage = "An error occurred while loading the application.";
        if (code === -105) {
          userMessage = "Unable to connect to the server. Please check your internet connection.";
        } else if (code === -106) {
          userMessage = "The connection was interrupted. Please try again.";
        } else if (code === -118) {
          userMessage = "The connection timed out. Please check your internet connection.";
        } else if (code === -3) {
          userMessage = "The server could not be reached. Please check your internet connection.";
        }
        
        if (errorMessage) errorMessage.textContent = userMessage;
        if (errorCode) errorCode.textContent = `Error ${code}: ${description}`;
      }

      // Expose showError globally for Electron error handler
      window.showError = showError;

      async function checkInternetConnection() {
        return new Promise((resolve) => {
          // First check navigator.onLine
          if (!navigator.onLine) {
            resolve(false);
            return;
          }

          // Try to fetch a small resource to verify actual connectivity
          const timeout = new Promise((_, reject) => 
            setTimeout(() => reject(new Error("Timeout")), 3000)
          );

          const fetchCheck = fetch("https://www.google.com/favicon.ico", {
            method: "HEAD",
            mode: "no-cors",
            cache: "no-cache"
          }).then(() => true).catch(() => false);

          Promise.race([fetchCheck, timeout])
            .then((result) => resolve(result === true))
            .catch(() => resolve(false));
        });
      }

      function goToApp() {
        isLoading = true;
        showLoading("Loading application...");
        
        // Mark body as loaded to hide loading card when page loads
        setTimeout(() => {
          document.body.classList.add("loaded");
          window.location.href = APP_URL;
        }, 300);
      }

      async function checkInternetAndLoad() {
        // Show splash screen first
        showSplash("Initializing...");
        
        // Wait a bit for splash screen animation
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Check internet connection
        if (splashStatus) splashStatus.textContent = "Checking connection...";
        showSplash("Checking connection...");
        
        const hasInternet = await checkInternetConnection();
        
        if (!hasInternet) {
          showOffline();
          return;
        }

        // Internet is available, proceed to load
        if (splashStatus) splashStatus.textContent = "Connecting...";
        showSplash("Connecting...");
        await new Promise(resolve => setTimeout(resolve, 500));
        
        goToApp();
      }

      document.addEventListener("DOMContentLoaded", () => {
        checkInternetAndLoad();

        window.addEventListener("online", () => {
          if (!isLoading) {
            checkInternetAndLoad();
          }
        });

        window.addEventListener("offline", () => {
          if (isLoading) {
            showOffline();
          }
        });

        if (retryBtn) {
          retryBtn.addEventListener("click", () => {
            checkInternetAndLoad();
          });
        }

        if (retryErrorBtn) {
          retryErrorBtn.addEventListener("click", () => {
            checkInternetAndLoad();
          });
        }

        // Handle page load completion
        window.addEventListener("load", () => {
          // If we successfully loaded the remote page, hide the card
          if (window.location.href.includes("app.zendowhisper.com")) {
            document.body.classList.add("loaded");
          }
        });

        // Handle navigation errors
        window.addEventListener("error", (event) => {
          if (isLoading && event.message && event.message.includes("Failed to fetch")) {
            showError(-3, "Network error");
          }
        });
      });
    </script>
  </body>
</html>
